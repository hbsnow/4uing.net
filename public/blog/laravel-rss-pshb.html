<!DOCTYPE html><html lang="ja" ng-app="mainApp"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="fragment" content="!"><meta name="author" content="hbsnow"><title page-title>LaravelでRSSの配信してPubSubHubbubでPushする | 4uing</title><base href="/"><link rel="alternate" href="/blog/feed.rss" title="RSS update information" type="application/rss+xml"><style>preloader{display:block;position:fixed;top:0;left:0;width:100%;height:100%;z-index:4;background-color:#f2f1ed}preloader .cage{position:fixed;bottom:0;top:50%;left:-10%;right:-10%;background-color:#b65252}preloader .cage .box{width:960px;height:300px;margin:auto;background-color:#b65252;position:relative;display:block;-webkit-filter:url(#goo);filter:url(#goo);-webkit-transform:translateZ(0);transform:translateZ(0)}preloader .drop-one,preloader .drop-two{border-radius:50%;overflow:hidden;position:absolute;background-color:#b65252}preloader .cage.two .box{-webkit-filter:url(#goo2);filter:url(#goo2)}preloader .drop-one{height:50px;width:50px;top:0;left:50%;-webkit-animation:big-drop 2s ease infinite;animation:big-drop 2s ease infinite}preloader .drop-two{height:40px;width:40px;top:10px;left:51%;-webkit-animation:big-drop 2s ease infinite .075s;animation:big-drop 2s ease infinite .075s}preloader .drop-four,preloader .drop-three{border-radius:50%;overflow:hidden;background-color:#b65252;position:absolute;height:20px;width:20px;top:10px;left:51%}preloader .drop-three{-webkit-animation:small-drop 2s ease infinite 1s;animation:small-drop 2s ease infinite 1s}preloader .drop-four{-webkit-animation:small-drop 2s ease infinite 1.075s;animation:small-drop 2s ease infinite 1.075s}preloader .ripple{height:25px;width:25px;border-radius:50%;overflow:hidden;background-color:#b65252;position:absolute;top:0}preloader .ripple.l-side{left:50%;-webkit-animation:left-ripple 2s ease infinite 1.2s;animation:left-ripple 2s ease infinite 1.2s}preloader .ripple.r-side{left:53%;-webkit-animation:right-ripple 2s ease infinite 1.2s;animation:right-ripple 2s ease infinite 1.2s}@-webkit-keyframes big-drop{0%,100%{top:25%}50%{top:-40%}}@keyframes big-drop{0%,100%{top:25%}50%{top:-40%}}@-webkit-keyframes small-drop{0%,100%{top:25%}50%{top:-23%}}@keyframes small-drop{0%,100%{top:25%}50%{top:-23%}}@-webkit-keyframes left-ripple{0%,100%{left:51%;top:-30px}25%{left:25%}25%,49%{top:0}50%{left:51%;top:-25px}75%,99%{left:35%;top:0}}@keyframes left-ripple{0%,100%{left:51%;top:-30px}25%{left:25%}25%,49%{top:0}50%{left:51%;top:-25px}75%,99%{left:35%;top:0}}@-webkit-keyframes right-ripple{0%,100%{left:53%;top:-30px}25%{left:75%}25%,49%,99%{top:0}50%{left:53%;top:-25px}75%{left:65%;top:0}}@keyframes right-ripple{0%,100%{left:53%;top:-30px}25%{left:75%}25%,49%,99%{top:0}50%{left:53%;top:-25px}75%{left:65%;top:0}}</style><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:400,700"><link rel="stylesheet" href="/styles/main.css"></head><body><div class="layout vertical"><header id="header" class="flex-none"><h1 id="site-title"><a href="/" ui-sref="home">4uing</a></h1><nav id="header-menu"><icon css-icon="menu" alt="Menu" click="true"></icon><ul><li><a href="/blog.html">Blog</a></li><li><a href="/about.html">About</a></li></ul></nav></header><main class="flex-auto"><div ui-view><article class="main-root"><header class="content-header"><nav id="breadcrumb"><div class="container"><div itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/blog.html" itemprop="url"><span itemprop="title">Blog</span></a></div></div></nav><div class="content-header-title"><div class="container"><h1 id="main-title">LaravelでRSSの配信してPubSubHubbubでPushする</h1></div></div><div class="content-header-meta"><div class="container"><div id="article-date"><div id="article-date-created"><time>2014-11-16</time></div><hr/><div id="article-date-updated"><time>2015-04-13</time></div></div><div id="article-tags"><ul><li><a href="/blog/tag/PHP.html" class="button">PHP</a></li><li><a href="/blog/tag/Laravel.html" class="button">Laravel</a></li></ul></div><div id="article-toc"><div class="container"><ol><li><a href="#migration">マイグレーション</a></li><li><a href="#controller">コントローラ</a></li><li><a href="#pshb">PubSubHubbub</a></li><li><a href="#sitemap">sitemap.xml</a></li><li><a href="#twitter">Twitterで更新を通知する</a></li><li><a href="#bibliography">参照文献</a></li></ol></div></div></div></div></header><div class="content-body"><div class="container"><div class="paragraph">
<p>Laravel5でRSS1.0とsitemap.xmlを配信してみます。</p>
</div>
<div class="paragraph">
<p><a href="http://localdisk.hatenablog.com/entry/2014/01/27/Response%3A%3Axml_macro_%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%88">Response::xml macro を作ったよ - localdisk</a>を参考にすると、名前空間と属性を使う必要のないRSS2.0と名前空間をルートに指定するだけでいいAtomであれば簡単に作成できるはずなので、わざわざRSS1.0にしなくても素直にAtomを使っておけばいいとおもう。</p>
</div>
<div class="paragraph">
<p>今回AtomではなくRSS1.0を採用した理由は<code>atom:summary</code>もしくは<code>atom:content</code>のどちらも面倒なのでフィードに含めたくなかったことが理由です。</p>
</div>
<div class="sect1">
<h2 id="migration">マイグレーション</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ps1" data-lang="ps1">php artisan migrate:make articles_setup_table</code></pre>
</div>
</div>
<div class="paragraph">
<p>マイグレーションから作る。このブログで使っているものといまのところまったく同じ。今回のブログでは公開日と<code>create_at</code>が等価なので公開日にあたるキーは作成しません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">up</span><span class="hljs-params">()</span>
</span>{
    Schema::create(<span class="hljs-string">'articles'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-variable">$table</span>)</span>
    </span>{
        <span class="hljs-variable">$table</span>-&gt;increments(<span class="hljs-string">'id'</span>)-&gt;unsigned();
        <span class="hljs-variable">$table</span>-&gt;string(<span class="hljs-string">'title'</span>, <span class="hljs-number">256</span>);
        <span class="hljs-variable">$table</span>-&gt;string(<span class="hljs-string">'slug'</span>, <span class="hljs-number">128</span>)-&gt;unique;
        <span class="hljs-variable">$table</span>-&gt;string(<span class="hljs-string">'state'</span>, <span class="hljs-number">16</span>);
        <span class="hljs-variable">$table</span>-&gt;timestamps();
    });
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>RSS出力のために必要なものだけの最小の構成にしようと思ったんだけど、コントローラの一部メソッドの書き換えが面倒なので影響のない範囲でのギリギリの構成になっています。</p>
</div>
<div class="paragraph">
<p><code>state</code>は記事の公開状態で、例えばあとでログインユーザのみに公開するような設定とかを追加したいときに困るので<code>boolean</code>ではありません。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ps1" data-lang="ps1">php artisan migrate</code></pre>
</div>
</div>
<div class="paragraph">
<p>これでテーブルの作成が終了しました。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="controller">コントローラ</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php"><span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Blog</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>\<span class="hljs-title">Controller</span>;
<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Blog</span>\<span class="hljs-title">Article</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RssController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-variable">$dom</span>;

    <span class="hljs-comment">/**
     * コンストラクタ
     *
     * <span class="hljs-doctag">@return</span> void
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$root</span> = <span class="hljs-string">'ルートのURL'</span>;
        <span class="hljs-variable">$rss</span> = <span class="hljs-string">'出力するRSSのURL'</span>;
        <span class="hljs-variable">$data</span> = <span class="hljs-string">&lt;&lt;&lt;XML
&lt;rdf:RDF xml:lang="ja"
 xmlns="http://purl.org/rss/1.0/"
 xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
 xmlns:atom="http://www.w3.org/2005/Atom"
 xmlns:dc="http://purl.org/dc/elements/1.1/"&gt;
    &lt;channel rdf:about="{$rss}"&gt;
        &lt;title&gt;4uing&lt;/title&gt;
        &lt;link&gt;{$root}&lt;/link&gt;
        &lt;atom:link href="{$rss}" rel="self" type="application/rss+xml" /&gt;
        &lt;atom:link rel="hub" href="http://pubsubhubbub.appspot.com" /&gt;
        &lt;description&gt;プログラムやウェブ制作についての情報を配信しています。&lt;/description&gt;
        &lt;items&gt;&lt;rdf:Seq/&gt;&lt;/items&gt;
    &lt;/channel&gt;
&lt;/rdf:RDF&gt;
XML;</span>

        <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> \DOMDocument;
        <span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-variable">$data</span>);
        <span class="hljs-variable">$dom</span>-&gt;encoding = <span class="hljs-string">'UTF-8'</span>;
        <span class="hljs-variable">$this</span>-&gt;dom = <span class="hljs-variable">$dom</span>;
    }

    <span class="hljs-comment">/**
     * RSSの表示
     *
     * <span class="hljs-doctag">@return</span> Response
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> response(<span class="hljs-variable">$this</span>-&gt;getXml(), <span class="hljs-number">200</span>)-&gt;header(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/xml'</span>);
    }

    <span class="hljs-comment">/**
     * XMLの生成
     *
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getXml</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// add Article</span>
        <span class="hljs-variable">$this</span>-&gt;addArticle();

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;dom-&gt;saveXML();
    }

    <span class="hljs-comment">/**
     * 公開済みのブログの記事を追加
     *
     * <span class="hljs-doctag">@return</span> DOMDocument
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addArticle</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$articles</span> = Article::where(<span class="hljs-string">'state'</span>, <span class="hljs-string">'public'</span>)-&gt;get();

        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$articles</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$article</span>)
        {
            <span class="hljs-variable">$this</span>-&gt;add(<span class="hljs-variable">$article</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;dom;
    }

    <span class="hljs-comment">/**
     * RSSにデータを追加する
     *
     * <span class="hljs-doctag">@param</span> Article $article
     * <span class="hljs-doctag">@return</span> DOMDocument
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-variable">$article</span>)</span>
    </span>{
        <span class="hljs-variable">$root</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;documentElement;
        <span class="hljs-variable">$rdf_ns</span> = <span class="hljs-string">'http://www.w3.org/1999/02/22-rdf-syntax-ns#'</span>;
        <span class="hljs-variable">$channel</span> = <span class="hljs-variable">$root</span>-&gt;getElementsByTagNameNS(<span class="hljs-variable">$rdf_ns</span>, <span class="hljs-string">'Seq'</span>)-&gt;item(<span class="hljs-number">0</span>);

        <span class="hljs-variable">$loc</span> = route(<span class="hljs-string">'blog.show'</span>, <span class="hljs-variable">$article</span>-&gt;slug);

        <span class="hljs-variable">$li</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElementNS(<span class="hljs-variable">$rdf_ns</span>, <span class="hljs-string">'rdf:li'</span>);
        <span class="hljs-variable">$li</span>-&gt;setAttributeNS(<span class="hljs-variable">$rdf_ns</span>, <span class="hljs-string">'rdf:resource'</span>, <span class="hljs-variable">$loc</span>);
        <span class="hljs-variable">$channel</span>-&gt;appendChild(<span class="hljs-variable">$li</span>);

        <span class="hljs-variable">$item</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElement(<span class="hljs-string">'item'</span>);
        <span class="hljs-variable">$item</span>-&gt;setAttributeNS(<span class="hljs-variable">$rdf_ns</span>, <span class="hljs-string">'rdf:about'</span>, <span class="hljs-variable">$loc</span>);
        <span class="hljs-variable">$root</span>-&gt;appendChild(<span class="hljs-variable">$item</span>);

        <span class="hljs-variable">$title</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElement(<span class="hljs-string">'title'</span>);
        <span class="hljs-variable">$title</span>-&gt;appendChild(<span class="hljs-variable">$this</span>-&gt;dom-&gt;createTextNode(<span class="hljs-variable">$article</span>-&gt;title));
        <span class="hljs-variable">$item</span>-&gt;appendChild(<span class="hljs-variable">$title</span>);

        <span class="hljs-variable">$link</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElement(<span class="hljs-string">'link'</span>);
        <span class="hljs-variable">$link</span>-&gt;appendChild(<span class="hljs-variable">$this</span>-&gt;dom-&gt;createTextNode(<span class="hljs-variable">$loc</span>));
        <span class="hljs-variable">$item</span>-&gt;appendChild(<span class="hljs-variable">$link</span>);

        <span class="hljs-variable">$date</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElementNS(<span class="hljs-string">'http://purl.org/dc/elements/1.1/'</span>, <span class="hljs-string">'dc:date'</span>);
        <span class="hljs-variable">$date</span>-&gt;appendChild(<span class="hljs-variable">$this</span>-&gt;dom-&gt;createTextNode(<span class="hljs-variable">$article</span>-&gt;created_at-&gt;format(<span class="hljs-string">'Y-m-d'</span>)));
        <span class="hljs-variable">$item</span>-&gt;appendChild(<span class="hljs-variable">$date</span>);

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;dom;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>PHPでDOMを使うのはたぶん7, 8年ぶりだったとおもう。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pshb">PubSubHubbub</h2>
<div class="sectionbody">
<div class="paragraph">
<p>せっかくなので<a href="http://pubsubhubbub.appspot.com/">PubSubHubbub</a>でGoogleに更新情報をPushします。composerからインストールできるよさそうなライブラリがなかったので自分で作りました。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/hbsnow/pshb">hbsnow/pshb</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>require</code>に<code>"hbsnow/pshb": "~1.0.1"</code>を追加して、<code>composer update</code>でインストールするだけです。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php"><span class="hljs-comment">/**
 * PSHB
 *
 * <span class="hljs-doctag">@return</span> string
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pshb</span><span class="hljs-params">()</span>
</span>{
    <span class="hljs-variable">$message</span> = <span class="hljs-string">''</span>;

    <span class="hljs-keyword">if</span> (App::env(<span class="hljs-string">'APP_ENV'</span>) !== <span class="hljs-string">'local'</span>) {
        <span class="hljs-variable">$pshb</span> = <span class="hljs-keyword">new</span> Publisher(<span class="hljs-string">'http://pubsubhubbub.appspot.com/'</span>);
        <span class="hljs-variable">$rss</span> = route(<span class="hljs-string">'blog.rss'</span>);

        <span class="hljs-keyword">if</span> (! <span class="hljs-variable">$pshb</span>-&gt;update(<span class="hljs-variable">$rss</span>)) {
            <span class="hljs-variable">$message</span> = <span class="hljs-string">'PubSubHubBubのPostに失敗しました。'</span>;
        }
    }

    <span class="hljs-keyword">return</span> <span class="hljs-variable">$message</span>;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>こんな感じで使います。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sitemap">sitemap.xml</h2>
<div class="sectionbody">
<div class="paragraph">
<p>ついでに<code>sitemap.xml</code>も作りました。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php"><span class="hljs-preprocessor">&lt;?php</span> <span class="hljs-keyword">namespace</span> <span class="hljs-title">App</span>\<span class="hljs-title">Http</span>\<span class="hljs-title">Controllers</span>;

<span class="hljs-keyword">use</span> <span class="hljs-title">App</span>\<span class="hljs-title">Eloquent</span>\<span class="hljs-title">Blog</span>\<span class="hljs-title">Article</span>;

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">SitemapController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Controller</span> </span>{

    <span class="hljs-keyword">private</span> <span class="hljs-variable">$dom</span>;
    <span class="hljs-keyword">private</span> <span class="hljs-variable">$main_contents</span>;

    <span class="hljs-comment">/**
     * コンストラクタ
     *
     * <span class="hljs-doctag">@return</span> void
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$dom</span> = <span class="hljs-keyword">new</span> \DOMDocument;
        <span class="hljs-variable">$dom</span>-&gt;loadXML(<span class="hljs-string">'&lt;urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"&gt;&lt;/urlset&gt;'</span>);
        <span class="hljs-variable">$dom</span>-&gt;encoding = <span class="hljs-string">'UTF-8'</span>;
        <span class="hljs-variable">$this</span>-&gt;dom = <span class="hljs-variable">$dom</span>;

        <span class="hljs-variable">$this</span>-&gt;main_contents = [
            <span class="hljs-string">'コンテンツURLの配列'</span>
        ];
    }

    <span class="hljs-comment">/**
     * サイトマップの表示
     *
     * <span class="hljs-doctag">@return</span> Response
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">return</span> response(<span class="hljs-variable">$this</span>-&gt;getXml(), <span class="hljs-number">200</span>)-&gt;header(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/xml'</span>);
    }

    <span class="hljs-comment">/**
     * XMLの生成
     *
     * <span class="hljs-doctag">@return</span> string
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getXml</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-comment">// add Contents</span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$this</span>-&gt;main_contents <span class="hljs-keyword">as</span> <span class="hljs-variable">$value</span>) {
            call_user_func_array(<span class="hljs-keyword">array</span>(<span class="hljs-variable">$this</span>, <span class="hljs-string">'add'</span>), <span class="hljs-variable">$value</span>);
        }

        <span class="hljs-comment">// add Article</span>
        <span class="hljs-variable">$this</span>-&gt;addArticle();

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;dom-&gt;saveXML();
    }

    <span class="hljs-comment">/**
     * 公開済みのブログの記事を追加
     *
     * <span class="hljs-doctag">@return</span> DOMDocument
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addArticle</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-variable">$articles</span> = Article::where(<span class="hljs-string">'state'</span>, <span class="hljs-string">'public'</span>)-&gt;get();

        <span class="hljs-keyword">foreach</span>(<span class="hljs-variable">$articles</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$article</span>)
        {
            <span class="hljs-variable">$this</span>-&gt;add(<span class="hljs-string">'記事のURL'</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;dom;
    }

    <span class="hljs-comment">/**
     * サイトマップにデータを追加する
     *
     * <span class="hljs-doctag">@param</span> string $loc
     * <span class="hljs-doctag">@param</span> string $changefreq
     * <span class="hljs-doctag">@return</span> DOMDocument
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span><span class="hljs-params">(<span class="hljs-variable">$loc</span>, <span class="hljs-variable">$changefreq</span> = null)</span>
    </span>{
        <span class="hljs-variable">$root</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;documentElement;

        <span class="hljs-comment">// urlset &gt; url</span>
        <span class="hljs-variable">$url_elem</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElement(<span class="hljs-string">'url'</span>);
        <span class="hljs-variable">$root</span>-&gt;appendChild(<span class="hljs-variable">$url_elem</span>);

        <span class="hljs-comment">// url &gt; loc</span>
        <span class="hljs-variable">$loc_elem</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElement(<span class="hljs-string">'loc'</span>);
        <span class="hljs-variable">$loc_elem</span>-&gt;appendChild(<span class="hljs-variable">$this</span>-&gt;dom-&gt;createTextNode(<span class="hljs-variable">$loc</span>));
        <span class="hljs-variable">$url_elem</span>-&gt;appendChild(<span class="hljs-variable">$loc_elem</span>);

        <span class="hljs-comment">// url &gt; changefreq</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-variable">$changefreq</span> !== <span class="hljs-keyword">null</span>)
        {
            <span class="hljs-variable">$changefreq_elem</span> = <span class="hljs-variable">$this</span>-&gt;dom-&gt;createElement(<span class="hljs-string">'changefreq'</span>);
            <span class="hljs-variable">$changefreq_elem</span>-&gt;appendChild(<span class="hljs-variable">$this</span>-&gt;dom-&gt;createTextNode(<span class="hljs-variable">$changefreq</span>));
            <span class="hljs-variable">$url_elem</span>-&gt;appendChild(<span class="hljs-variable">$changefreq_elem</span>);
        }

        <span class="hljs-keyword">return</span> <span class="hljs-variable">$this</span>-&gt;dom;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>処理の内容はRSSとほとんど同じです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="twitter">Twitterで更新を通知する</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Twitterでの更新の通知は<a href="https://dlvr.it/">dlvr.it</a>や<a href="https://twibble.io/">Twibble.io</a>のようなWebサービスを使うこともできるけれども、サービス内容に変更があるかもしれないという不安はあるのでWebサービスに頼らずに作成しました。</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/thujohn/twitter">thujohn/twitter</a>を使うのでcomposerでインストールし、ドキュメントの指示通り<code>config/app.php</code>に必要項目を追記して、追記後にコンフィグを生成します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ps1" data-lang="ps1">php artisan vendor:publish</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力された設定ファイル<code>ttwitter.php</code>に<a href="https://apps.twitter.com/">Twitter Apps</a>で作成した情報を入力する。確認のついでにTwitter側のパーミッション設定もRead and Writeに変更しておきます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-php" data-lang="php"><span class="hljs-comment">/**
 * Tweet
 *
 * <span class="hljs-doctag">@param</span> string $title
 * <span class="hljs-doctag">@param</span> string $url
 * <span class="hljs-doctag">@return</span> void
 */</span>
<span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tweet</span><span class="hljs-params">(<span class="hljs-variable">$title</span>, <span class="hljs-variable">$url</span>)</span>
</span>{
    <span class="hljs-variable">$status</span> = <span class="hljs-string">'"'</span> . <span class="hljs-variable">$title</span> . <span class="hljs-string">' | ここにサイトタイトル" '</span> . <span class="hljs-variable">$url</span>;
    Twitter::postTweet([<span class="hljs-string">'status'</span> =&gt; <span class="hljs-variable">$status</span>, <span class="hljs-string">'format'</span> =&gt; <span class="hljs-string">'json'</span>]);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>自分の使っているメソッドはこんな感じです。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bibliography">参照文献</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a href="http://scotch.io/tutorials/php/a-guide-to-using-eloquent-orm-in-laravel">A Guide to Using Eloquent ORM in Laravel ♥ Scotch</a></p>
</li>
<li>
<p><a href="http://www.sitemaps.org/ja/protocol.html">sitemaps.org - プロトコル</a></p>
</li>
</ul>
</div>
</div>
</div></div></div></article></div></main><footer id="footer" class="flex-none"><div class="container"><div id="footer-social"><ul class="layout horizontal"><li class="flex"><a href="https://twitter.com/hbsnow">Twitter</a></li><li class="flex"><a href="https://github.com/hbsnow">GitHub</a></li><li class="flex"><a href="/blog/feed.rss" target="_blank">RSS</a></li></ul></div><div id="footer-copyright"><p>&copy; 2015</p></div></div></footer><pageloader></pageloader><preloader><div class="cage"><div class="box"><div class="drop-one"></div><div class="drop-two"></div><div class="ripple l-side"></div><div class="ripple r-side"></div></div></div><div class="cage two"><div class="box"><div class="drop-three"></div><div class="drop-four"></div></div></div><svg xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><filter id="goo"><feGaussianBlur in="SourceGraphic" stdDeviation="15" result="blur"></feGaussianBlur><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo"></feColorMatrix><feComposite in="SourceGraphic" in2="goo" operator="atop"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><filter id="goo2"><feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur"></feGaussianBlur><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo"></feColorMatrix><feComposite in="SourceGraphic" in2="goo" operator="atop"></feComposite></filter></defs></svg></preloader></div><div id="javascript"><script src="/scripts/main.js"></script></div></body></html>