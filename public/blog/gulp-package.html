<!DOCTYPE html><html lang="ja" ng-app="mainApp"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="fragment" content="!"><meta name="author" content="hbsnow"><title page-title>gulpで使うパッケージのメモ | 4uing</title><base href="/"><link rel="alternate" href="/blog/feed.rss" title="RSS update information" type="application/rss+xml"><style>preloader{display:block;position:fixed;top:0;left:0;width:100%;height:100%;z-index:4;background-color:#f2f1ed}preloader .cage{position:fixed;bottom:0;top:50%;left:-10%;right:-10%;background-color:#b65252}preloader .cage .box{width:960px;height:300px;margin:auto;background-color:#b65252;position:relative;display:block;-webkit-filter:url(#goo);filter:url(#goo);-webkit-transform:translateZ(0);transform:translateZ(0)}preloader .drop-one,preloader .drop-two{border-radius:50%;overflow:hidden;position:absolute;background-color:#b65252}preloader .cage.two .box{-webkit-filter:url(#goo2);filter:url(#goo2)}preloader .drop-one{height:50px;width:50px;top:0;left:50%;-webkit-animation:big-drop 2s ease infinite;animation:big-drop 2s ease infinite}preloader .drop-two{height:40px;width:40px;top:10px;left:51%;-webkit-animation:big-drop 2s ease infinite .075s;animation:big-drop 2s ease infinite .075s}preloader .drop-four,preloader .drop-three{border-radius:50%;overflow:hidden;background-color:#b65252;position:absolute;height:20px;width:20px;top:10px;left:51%}preloader .drop-three{-webkit-animation:small-drop 2s ease infinite 1s;animation:small-drop 2s ease infinite 1s}preloader .drop-four{-webkit-animation:small-drop 2s ease infinite 1.075s;animation:small-drop 2s ease infinite 1.075s}preloader .ripple{height:25px;width:25px;border-radius:50%;overflow:hidden;background-color:#b65252;position:absolute;top:0}preloader .ripple.l-side{left:50%;-webkit-animation:left-ripple 2s ease infinite 1.2s;animation:left-ripple 2s ease infinite 1.2s}preloader .ripple.r-side{left:53%;-webkit-animation:right-ripple 2s ease infinite 1.2s;animation:right-ripple 2s ease infinite 1.2s}@-webkit-keyframes big-drop{0%,100%{top:25%}50%{top:-40%}}@keyframes big-drop{0%,100%{top:25%}50%{top:-40%}}@-webkit-keyframes small-drop{0%,100%{top:25%}50%{top:-23%}}@keyframes small-drop{0%,100%{top:25%}50%{top:-23%}}@-webkit-keyframes left-ripple{0%,100%{left:51%;top:-30px}25%{left:25%}25%,49%{top:0}50%{left:51%;top:-25px}75%,99%{left:35%;top:0}}@keyframes left-ripple{0%,100%{left:51%;top:-30px}25%{left:25%}25%,49%{top:0}50%{left:51%;top:-25px}75%,99%{left:35%;top:0}}@-webkit-keyframes right-ripple{0%,100%{left:53%;top:-30px}25%{left:75%}25%,49%,99%{top:0}50%{left:53%;top:-25px}75%{left:65%;top:0}}@keyframes right-ripple{0%,100%{left:53%;top:-30px}25%{left:75%}25%,49%,99%{top:0}50%{left:53%;top:-25px}75%{left:65%;top:0}}</style><link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:400,700"><link rel="stylesheet" href="/styles/main.css"></head><body><div class="layout vertical"><header id="header" class="flex-none"><h1 id="site-title"><a href="/" ui-sref="home">4uing</a></h1><nav id="header-menu"><icon css-icon="menu" alt="Menu" click="true"></icon><ul><li><a href="/blog.html">Blog</a></li><li><a href="/about.html">About</a></li></ul></nav></header><main class="flex-auto"><div ui-view><article class="main-root"><header class="content-header"><nav id="breadcrumb"><div class="container"><div itemscope="itemscope" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/blog.html" itemprop="url"><span itemprop="title">Blog</span></a></div></div></nav><div class="content-header-title"><div class="container"><h1 id="main-title">gulpで使うパッケージのメモ</h1></div></div><div class="content-header-meta"><div class="container"><div id="article-date"><div id="article-date-created"><time>2015-03-06</time></div><hr/><div id="article-date-updated"><time>2015-05-09</time></div></div><div id="article-tags"><ul><li><a href="/blog/tag/JavaScript.html" class="button">JavaScript</a></li><li><a href="/blog/tag/gulp.html" class="button">gulp</a></li></ul></div><div id="article-toc"><div class="container"><ol><li><a href="#file">ファイル</a><ol><li><a href="#require-dir">require-dir</a></li><li><a href="#del">del</a></li><li><a href="#gulp-rename">gulp-rename</a></li></ol></li><li><a href="#html">HTML</a><ol><li><a href="#gulp-inline-source">gulp-inline-source</a></li></ol></li><li><a href="#javascript">JavaScrpt</a><ol><li><a href="#gulp-ng-annotate">gulp-ng-annotate</a></li><li><a href="#gulp-jshint">gulp-jshint, jshint-stylish</a></li></ol></li><li><a href="#css">CSS</a><ol><li><a href="#gulp-less">gulp-less</a></li></ol></li><li><a href="#vinyl">vinyl</a><ol><li><a href="#vinyl-source-stream">vinyl-source-stream</a></li><li><a href="#vinyl-transform">vinyl-transform</a></li><li><a href="#vinyl-buffer">vinyl-buffer</a></li></ol></li><li><a href="#task">タスク</a><ol><li><a href="#lazypipe">lazypipe</a></li><li><a href="#run-sequence">run-sequence</a></li></ol></li><li><a href="#util">ユーティリティ</a><ol><li><a href="#gulp-util">gulp-util</a></li><li><a href="#gulp-if">gulp-if</a></li><li><a href="#gulp-exit">gulp-exit</a></li><li><a href="#gulp-exec">gulp-exec</a></li></ol></li><li><a href="#other">その他</a><ol><li><a href="#gulp-load-plugins">gulp-load-plugins</a></li><li><a href="#minimist">minimist</a></li><li><a href="#gulp-webserver">gulp-webserver</a></li></ol></li><li><a href="#bibliography">参照文献</a></li></ol></div></div></div></div></header><div class="content-body"><div class="container"><div class="paragraph">
<p>gulpで使うプラグインは毎回大体同じなので、よく使うもののメモを残しておく。カテゴリ分けはだいぶ適当。サンプルでは断りなくgulp-load-pluginsを使っているので<code>$.</code>ではじまるものは<code>gulp-</code>のパッケージを読み込んだものになっています。</p>
</div>
<div class="paragraph">
<p>基本的にgulpのプラグインを作ったりしたことがあるわけではないので、vinylの説明なんかはちょっと怪しいかもしれない。</p>
</div>
<div class="sect1">
<h2 id="file">ファイル</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>require-dir</p>
</li>
<li>
<p>del</p>
</li>
<li>
<p>gulp-rename</p>
</li>
<li>
<p>gulp-gzip: gzipに圧縮</p>
</li>
<li>
<p>gulp-concat: ファイルの結合</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="require-dir">require-dir</h3>
<div class="paragraph">
<p>ディレクトリ内のファイルを読み込むヘルパー。何に使うのかというと<code>gulpfile.js</code>を分割して管理されているようなものに使われています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> requireDir = <span class="hljs-built_in">require</span>(<span class="hljs-string">'require-dir'</span>);
requireDir(<span class="hljs-string">'gulp/tasks'</span>, {recurse: <span class="hljs-literal">true</span>});</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>recurse: true</code>はサブフォルダも読み込ませたいときに必要。ファイル分割するほどのタスクになることになることが自分の場合にはないので、<code>gulpfile.js</code>でこれを使うようなことはおそらくこれからもないんじゃないかとおもう。</p>
</div>
<div class="paragraph">
<p>実際にファイル分割するときのディレクトリ構成については<a href="https://github.com/greypants/gulp-starter">gulp-starter</a>で雰囲気がつかめる。</p>
</div>
</div>
<div class="sect2">
<h3 id="del">del</h3>
<div class="paragraph">
<p>ファイルを削除します。ビルド前にディレクトリ内のファイルを削除するのに使われています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.task(<span class="hljs-string">'clean'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
  del([<span class="hljs-string">'dist\**\*'</span>], cb);
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>複数のファイルをglobによるパターンマッチングで除外設定をすることもできて、例えば<code>.gitkeep</code>などの<code>.git</code>から始まるファイルを削除したくないときには以下のようになます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.task(<span class="hljs-string">'clean:dist'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
  del([<span class="hljs-string">'dist/**/*'</span>, <span class="hljs-string">'!dist/.git{,/**}'</span>], { dot: <span class="hljs-literal">true</span> }, cb);
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gulp-rename">gulp-rename</h3>
<div class="paragraph">
<p>ファイルのリネームをします。ただ単純にリネームをするというよりも、prefixやsuffixをつけたりといった使い方をすることが多いかな。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.task(<span class="hljs-string">'css'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src( <span class="hljs-string">'src/style.css'</span>)
  .pipe($.minifyCss())
  .pipe($.rename({ suffix: <span class="hljs-string">'.min'</span> }))
  .pipe(gulp.dest(<span class="hljs-string">'dist'</span>));
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>これで出力されるファイルのファイル名が<code>style.min.css</code>になります。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="html">HTML</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>gulp-jade: JadeをHTMLに変換する</p>
</li>
<li>
<p>gulp-inline-source</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="gulp-inline-source">gulp-inline-source</h3>
<div class="paragraph">
<p>外部CSS、JavaScriptをHTMLの<code>head</code>内に埋め込みます。Tumblrなどのテーマだったり、404などのエラーページでファイルを一つにまとめてしまいたいときに便利。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="javascript">JavaScrpt</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>browserify: <a href="http://4uing.net/blog/gulp-browserify/">gulpでBrowserifyを使う</a>を参照</p>
</li>
<li>
<p>watchify: <a href="http://4uing.net/blog/gulp-browserify/">gulpでBrowserifyを使う</a>を参照</p>
</li>
<li>
<p>gulp-webpack: <a href="http://4uing.net/blog/gulp-webpack/">gulpでWebPackを使う</a>を参照</p>
</li>
<li>
<p>gulp-ng-annotate</p>
</li>
<li>
<p>gulp-uglify: minify</p>
</li>
<li>
<p>gulp-jshint</p>
</li>
<li>
<p>jshint-stylish</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="gulp-ng-annotate">gulp-ng-annotate</h3>
<div class="paragraph">
<p>AngularJSでuglifyしても問題ないようにアノテーションを追加してくれます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">angular.module(<span class="hljs-string">"app"</span>).controller(<span class="hljs-string">"MyCtrl"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{});</code></pre>
</div>
</div>
<div class="paragraph">
<p>これが次のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">angular.module(<span class="hljs-string">"app"</span>).controller(<span class="hljs-string">"MyCtrl"</span>, [<span class="hljs-string">"$scope"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">$scope</span>) </span>{}]);</code></pre>
</div>
</div>
<div class="paragraph">
<p>自分でアノテーションを書くのは面倒なのでAngularJSを使うときにはこれを使うこともあります。</p>
</div>
</div>
<div class="sect2">
<h3 id="gulp-jshint">gulp-jshint, jshint-stylish</h3>
<div class="paragraph">
<p>jshint-stylishはgulp-jshintの出力を見やすくするためのもの。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.task(<span class="hljs-string">'jshint'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(<span class="hljs-string">'**/*.js'</span>)
  .pipe($.jshint())
  .pipe($.jshint.reporter(<span class="hljs-string">'jshint-stylish'</span>));
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>最近はAltJSを使うことが多いのであまり使うことはないかな。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="css">CSS</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>gulp-less</p>
</li>
<li>
<p>gulp-autoprefixer: ベンダプレフィックスをつける</p>
</li>
<li>
<p>gulp-minify-css: minify</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="gulp-less">gulp-less</h3>
<div class="paragraph">
<p>LESSをCSSに変換します。ソースマップをつけるには、gulp-sourcemapsを使う必要があります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> watch = <span class="hljs-literal">false</span>;
gulp.task(<span class="hljs-string">'build:less'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> src = <span class="hljs-string">'src/**/*.less'</span>;
  <span class="hljs-keyword">var</span> dist = <span class="hljs-string">'dist'</span>

  <span class="hljs-keyword">if</span>(watch) {
    <span class="hljs-keyword">return</span> gulp.src(src)
    .pipe($.plumber())
    .pipe($.sourcemaps.init())
    .pipe($.less())
    .pipe($.autoprefixer())
    .pipe($.sourcemaps.write())
    .pipe(gulp.dest(dist));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> gulp.src(src)
    .pipe($.less())
    .pipe($.autoprefixer())
    .pipe($.minifyCss())
    .pipe(gulp.dest(dist));
  }
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>pluginsでautoprefixを使おうとするとなぜかエラーになったので、ソースマップの出力後にプレフィックスをつけています。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="vinyl">vinyl</h2>
<div class="sectionbody">
<div class="paragraph">
<p>browserifyを使うときに使う。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>vinyl-source-stream</p>
</li>
<li>
<p>vinyl-transform</p>
</li>
<li>
<p>vinyl-buffer</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="vinyl-source-stream">vinyl-source-stream</h3>
<div class="paragraph">
<p>vinylのstreamに変換します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> stream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-source-stream'</span>);
<span class="hljs-keyword">var</span> browserify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browserify'</span>);
<span class="hljs-keyword">var</span> src = <span class="hljs-string">'src/main.js'</span>;

browserify(src)
  .bundle()
  .pipe(source(src))
  .pipe(gulp.dest(<span class="hljs-string">'dist'</span>));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="vinyl-transform">vinyl-transform</h3>
<div class="paragraph">
<p>vinyl-source-streamと同じくvinylのstreamに変換します。ファイル名を引数に取れるので複数のファイルに対応できます。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> transform = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-transform'</span>);
<span class="hljs-keyword">var</span> browserify = <span class="hljs-built_in">require</span>(<span class="hljs-string">'browserify'</span>);

gulp.task(<span class="hljs-string">'js'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(<span class="hljs-string">'**/*.js'</span>)
  .pipe(transform(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filename</span>) </span>{
    <span class="hljs-keyword">return</span> browserify(filename, {
    debug: <span class="hljs-literal">true</span>
    }).bundle();
  }))
  .pipe(gulp.dest(<span class="hljs-string">'dist'</span>));
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>browserifyでファイルを複数指定するようなことはないとおもうけど、フォルダ構成をそのまま維持させたたいとかなら便利なのかもしれない。</p>
</div>
</div>
<div class="sect2">
<h3 id="vinyl-buffer">vinyl-buffer</h3>
<div class="paragraph">
<p>vinylのstreamをbufferに変換します。vinyl-source-streamやvinyl-transformはstreamに変換するので<code>.pipe</code>で別の処理を加えるときにはこれをつかってbufferに変換する必要があります。</p>
</div>
<div class="paragraph">
<p>例えば次のような記述はエラーになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">browserify(src)
  .bundle()
  .pipe(source(src))
  .pipe($.uglify())
  .pipe(gulp.dest(dist));</code></pre>
</div>
</div>
<div class="paragraph">
<p>これはstreamを渡しているせいで、これを動作させるには次のようにvinyl-bufferを使うといい。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> buffer = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vinyl-buffer'</span>);

browserify(src)
  .bundle()
  .pipe(source(src))
  .pipe(buffer())
  .pipe($.uglify())
  .pipe(gulp.dest(dist));</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="task">タスク</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>lazypipe</p>
</li>
<li>
<p>run-sequence</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="lazypipe">lazypipe</h3>
<div class="paragraph">
<p>別々のタスクで同じ流れの処理があるとき、それぞれのタスクで同じ記述を避けたいときに使う。使いそうであまり使った記憶がない。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> lessMapTasks = lazypipe()
  .pipe($.sourcemaps.init())
  .pipe($.less())
  .pipe($.sourcemaps.write());

gulp.task(<span class="hljs-string">'build:less'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(src)
    .pipe(lessMapTasks())
    .pipe(gulp.dest(dist));
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>具体的にどういうときに使うのかちょっといい場面が思いつかない。</p>
</div>
</div>
<div class="sect2">
<h3 id="run-sequence">run-sequence</h3>
<div class="paragraph">
<p>タスクの実行順序を指定します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.task(<span class="hljs-string">'build'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  runSequence(<span class="hljs-string">'clean'</span>, [<span class="hljs-string">'js'</span>, <span class="hljs-string">'less'</span>], callback);
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="util">ユーティリティ</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>gulp-util</p>
</li>
<li>
<p>gulp-if</p>
</li>
<li>
<p>gulp-exit</p>
</li>
<li>
<p>gulp-exec</p>
</li>
<li>
<p>gulp-debug: vinylのstreamの状態を確認する</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="gulp-util">gulp-util</h3>
<div class="paragraph">
<p>ログを綺麗に出力したり、ストリームをそのまま何もせず返したりなんかができる。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">$.util.log($.util.colors.cyan(<span class="hljs-string">'ここはCyanで表示されます。'</span>));

<span class="hljs-keyword">var</span> watch;
gulp.task(<span class="hljs-string">'watch:less'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  watch = <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">return</span> gulp.src(src)
    .pipe(watch ? $.plumber() : $.util.noob())
    .pipe($.less())
    .pipe(gulp.dest(dist));
});</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gulp-if">gulp-if</h3>
<div class="paragraph">
<p>gulp-ifを使ってgulp-utilのサンプルを書き換えると以下のようになります。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">return</span> gulp.src(src)
  .pipe($.<span class="hljs-keyword">if</span>(watch, $.plumber()))
  .pipe($.less())
  .pipe(gulp.dest(dist));</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="gulp-exit">gulp-exit</h3>
<div class="paragraph">
<p>処理を抜ける。以下はgulp-utilのサンプルに追記したもの。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">return</span> gulp.src(src)
  .pipe($.less())
  .pipe(gulp.dest(<span class="hljs-string">'dist'</span>))
  .pipe($.<span class="hljs-keyword">if</span>(minify, $.exit()))
  .pipe($.minifyCss())
  .pipe($.rename({suffix: <span class="hljs-string">'.min'</span>}))
  .pipe(gulp.dest(dist));</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>minify</code>が<code>false</code>のとき、<code>*.min.css</code>も出力しています。これを<code>watch</code>で使うと監視も停止してしまうので注意が必要です。</p>
</div>
</div>
<div class="sect2">
<h3 id="gulp-exec">gulp-exec</h3>
<div class="paragraph">
<p>shellのコマンドを実行します。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.src(<span class="hljs-string">'build.js'</span>, {read: <span class="hljs-literal">false</span>})
  .pipe($.exec(<span class="hljs-string">'node &lt;%= file.path %&gt;'</span>));</code></pre>
</div>
</div>
<div class="paragraph">
<p>例えば<code>node build.js</code>したときプラグインを使うとビルドが終わるまで待つことなく次のタスクに移行します。ビルドの終了まで待機させたいときには<code>require('child_process').exec</code>を使います。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> exec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'child_process'</span>).exec;

gulp.task(<span class="hljs-string">'build:metalsmith'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
  exec(<span class="hljs-string">'node build.js'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stdout, stderr</span>) </span>{
    <span class="hljs-built_in">console</span>.log(stdout);
    <span class="hljs-built_in">console</span>.log(stderr);
    cb(err);
  });
});</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="other">その他</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p>gulp-load-plugins</p>
</li>
<li>
<p>gulp-plumber: エラーでwatchがとまるのを防ぐ。gulp-lessのサンプル参照</p>
</li>
<li>
<p>gulp-sourcemaps: ソースマップの作成。gulp-lessのサンプル参照</p>
</li>
<li>
<p>minimist</p>
</li>
<li>
<p>gulp-webserver</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="gulp-load-plugins">gulp-load-plugins</h3>
<div class="paragraph">
<p><code>gulp-</code>や<code>gulp.</code>などのプレフィックスがつたパッケージをまとめてロードします。このページのすべてのサンプルで使用しています。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> $ = <span class="hljs-built_in">require</span>(<span class="hljs-string">'gulp-load-plugins'</span>)();</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="minimist">minimist</h3>
<div class="paragraph">
<p>コマンドの解析。自分はgulpでオプションを作っても忘れるので使うことはないかな。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js"><span class="hljs-keyword">var</span> argv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'minimist'</span>)(process.argv.slice(<span class="hljs-number">2</span>));
<span class="hljs-keyword">var</span> release = !!argv.release;

<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'[RELEASE]'</span>, release);</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>gulp --rerease</code>で<code>release</code>がtrueになります。</p>
</div>
</div>
<div class="sect2">
<h3 id="gulp-webserver">gulp-webserver</h3>
<div class="paragraph">
<p>サーバをたてられることに加えてライブロードも可能。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-js" data-lang="js">gulp.task(<span class="hljs-string">'serve'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> gulp.src(<span class="hljs-string">'build'</span>)
    .pipe($.webserver({
      livereload: <span class="hljs-literal">true</span>,
      directoryListing: <span class="hljs-literal">true</span>,
      open: <span class="hljs-literal">true</span>
    }));</code></pre>
</div>
</div>
<div class="paragraph">
<p>出力先のフォルダを監視しておけば、ビルド終了後にブラウザを再読み込みしてくれます。</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="bibliography">参照文献</h2>
<div class="sectionbody">
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a href="https://github.com/greypants/gulp-starter">gulp-starter</a></p>
</li>
<li>
<p><a href="https://medium.com/@sogko/gulp-browserify-the-gulp-y-way-bb359b3f9623">gulp + browserify, the gulp-y way</a></p>
</li>
</ul>
</div>
</div>
</div></div></div></article></div></main><footer id="footer" class="flex-none"><div class="container"><div id="footer-social"><ul class="layout horizontal"><li class="flex"><a href="https://twitter.com/hbsnow">Twitter</a></li><li class="flex"><a href="https://github.com/hbsnow">GitHub</a></li><li class="flex"><a href="/blog/feed.rss" target="_blank">RSS</a></li></ul></div><div id="footer-copyright"><p>&copy; 2015</p></div></div></footer><pageloader></pageloader><preloader><div class="cage"><div class="box"><div class="drop-one"></div><div class="drop-two"></div><div class="ripple l-side"></div><div class="ripple r-side"></div></div></div><div class="cage two"><div class="box"><div class="drop-three"></div><div class="drop-four"></div></div></div><svg xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><filter id="goo"><feGaussianBlur in="SourceGraphic" stdDeviation="15" result="blur"></feGaussianBlur><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo"></feColorMatrix><feComposite in="SourceGraphic" in2="goo" operator="atop"></feComposite></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" version="1.1"><defs><filter id="goo2"><feGaussianBlur in="SourceGraphic" stdDeviation="8" result="blur"></feGaussianBlur><feColorMatrix in="blur" mode="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 19 -9" result="goo"></feColorMatrix><feComposite in="SourceGraphic" in2="goo" operator="atop"></feComposite></filter></defs></svg></preloader></div><div id="javascript"><script src="/scripts/main.js"></script></div></body></html>